<!DOCTYPE html>
<html lang="Farsi">
<head>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-69680858-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-69680858-2');
</script>

<meta name="msvalidate.01" content="584FCFDB107AA46299F59A2F22EBDF34" />

<title>لاراول، از صفر تا شصت | جدول‌هایی برای آپولو</title>

<meta charset="utf-8">
<meta name="description" content="راهنمایی گام به گام برای ورود به دنیای لاراول">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:type" content="website">
<meta property="og:title" content="">
<meta property="og:url" content="https://dutymess.github.io/laravel-0-to-60">
<meta property="og:site_name" content="لاراول، از صفر تا شصت">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="">
<meta name="twitter:description" content="">

  <link rel="short icon" href="/static/img/mira.png">
  <link href="/laravel-0-to-60/static/node_modules/bulma-rtl/css/bulma-rtl.css" rel="stylesheet">
  <link href="/laravel-0-to-60/static/zero60/style.css" rel="stylesheet">
  <link href="/laravel-0-to-60/static/zero60/agate.css" rel="stylesheet">
  <link href="https://cdn.rawgit.com/rastikerdar/sahel-font/v1.0.0-alpha13/dist/font-face.css" rel="stylesheet" type="text/css" />

</head>
<body>

  <header class="hero is-info columns">
    <div class="hero-body">
        <div class="container">
            <h1 class="title">
              <a href="/laravel-0-to-60">
                لاراول، از صفر تا شصت
              </a>
            </h1>
            <h2 class="subtitle">راهنمایی گام به گام برای ورود به دنیای لاراول</h2>
        </div>
    </div>
    <span class="sidebar_toggle">
        <em class="open-icon"></em>
    </span>
</header>

  <section class="main-content columns is-fullheight">
    <aside id="sidebar" class="column is-one-quarter-desktop is-one-third-tablet section ">
  <div class="sidebar__inner">
    <ul class="menu-list">
        
        <li>
        
        
          <span class="season">پیشگفتار</span>
          <ul>
        
            <li>
              <a href="/laravel-0-to-60/chapter00/lesson01/preface/">- ماجرای این کتاب</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter00/lesson02/thanks/">- تشکر می‌کنم</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter00/lesson03/support/">- حمایت از کتاب</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter00/lesson04/feedback/">- بازخورد</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter00/lesson05/publish/">- انتشار کتاب</a>
            </li>
        
        </ul>
        </li>
        
        <li>
        
        
          <span class="season">فصل اول: پیش به سوی صفر</span>
          <ul>
        
            <li>
              <a href="/laravel-0-to-60/chapter01/lesson01/mvc/">- معماری MVC</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter01/lesson02/composer/">- کامپوزر و مدیریت بسته‌ها</a>
            </li>
        
        </ul>
        </li>
        
        <li>
        
        
          <span class="season">فصل دوم: لاراول، در حد صفر</span>
          <ul>
        
            <li>
              <a href="/laravel-0-to-60/chapter02/lesson01/install/">- نصب و راه اندازی لاراول</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter02/lesson02/folders/">- ساختار پوشه‌های لاراول</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter02/lesson03/artisan/">- کنسول آرتیزان</a>
            </li>
        
        </ul>
        </li>
        
        <li>
        
        
          <span class="season">فصل سوم: شروع واقعی با دیتابیس</span>
          <ul>
        
            <li>
              <a href="/laravel-0-to-60/chapter03/lesson01/config/">- پیکربندی‌ها در لاراول</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter03/lesson02/database/">- پیکربندی دیتابیس</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter03/lesson03/understanding-migrations/">- درک مفهوم مایگرشن</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter03/lesson04/migrations/">- طراحی دیتابیس با مایگرشن</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter03/lesson05/apollo-tables/">- جدول‌هایی برای آپولو</a>
            </li>
        
        </ul>
        </li>
        
    </ul>
  </div>
</aside>

    <div class="container column">
        <div class="section" id="content">

  
      
          <h1 class="list">فصل سوم: شروع واقعی با دیتابیس</h1>
      

    <h3 class="list">جدول‌هایی برای آپولو</h3>

    <div class="content-body content">
    <a name="more"></a>
<p>در درس‌های قبل این فصل، که همگی به کار با دیتابیس اختصاص داشتند، پیکربندی دیتابیس را آموختیم و سپس با مفهوم مایگرشن آشنا شدیم و اصول اولیه ساخت و ویرایش جدول‌ها به کمک آن را فرا گرفتیم و دانستیم که چطور می‌توانیم به لطف مایگرشن، فرآیند ایجاد و مدیریت ساختار جدول‌های اطلاعاتی خود را به محیط کدنویسی برنامه بیاوریم و چتر سیستم کنترل نسخه‌ی خود را بر آن بیافکنیم.</p>

<p>در این درس برای نخستین بار به طور جدی سراغ آپولو هوا کردنمان می‌رویم و از آنجا که شروع پروژه‌ها همیشه با تعریف و راه‌اندازی دیتابیس آغاز می‌شود، این پروژه را نیز با ساخت جدول‌هایش کلید می‌زنیم.</p>

<h1>یک شروع تمیز</h1>

<p>بد نیست حالا که می‌خواهیم دست به کد شویم، همه چیز را از صفر شروع کنیم؛ یعنی از نقطه‌ای که پیکربندی دیتابیس را انجام داده‌ایم، ولی هنوز هیچ مایگرشنی ننوشته‌ایم.</p>

<p>اگر برای تمرین مایگرشنی نوشته‌اید و اجرا کرده‌اید، دیتابیس و فایل‌هایی که ساخته‌اید را به صورت دستی پاک کنید. </p>

<p>بهتر است محض اطمینان، از کامپوزر بخواهید تا یک بار فهرست فایل‌های Autoload را به‌روزرسانی کند. برای این کار، دستور زیر را در کنسول خط فرمان خود اجرا کنید.</p>

<pre><code class="language-bash">composer dump-autoload
</code></pre>

<h1>جدولی برای مأموریت‌های فضایی</h1>

<p>اولین جدولی که می‌سازیم، جدولی‌ست که اطلاعات مأموریت‌های فضایی را در آن نگهداری می‌کنیم.</p>

<p>شما اکنون می‌دانید که برای ساخت مایگرشن مربوط به این جدول، به چه دستور آرتیزانی نیاز داریم.</p>

<pre><code class="language-bash">php artisan make:migration create_missions_table
</code></pre>

<p>و می‌دانید که با اجرای این دستور، لاراول کلاسی برای ما می‌سازد و بدنه‌ی خام آن را تکمیل می‌کند. </p>

<p>اجازه بدهید با این پیش‌فرض که همراه من جلو می‌آیید و کارهایی که می‌گویم را واقعاً انجام می‌دهید، از نمایش تصویر اسکرین‌شات از اجرای دستور بالا در کنسول خط فرمان و کد تولیدشده، صرف نظر کنم و سراغ اصل مطلب برویم.</p>

<h2>چه ستون‌هایی لازم داریم؟</h2>

<p>این اولین پرسشی‌ست که هنگام طراحی یک جدول با آن مواجه می‌شویم، اما اولین پرسشی نیست که باید جوابش را بیابیم. سؤال درست در این مرحله، چیز دیگری است:</p>

<h2>چه داده‌هایی را قرار است نگهداری کنیم؟</h2>

<p>این شد یک چیزی! اگر بدانیم که چه داده‌هایی را قرار است در جدول خود بریزیم، می‌توانیم در مورد کمّ و کیف ستون‌های آن نیز تصمیم درستی بگیریم.</p>

<p>عجالتاً فرض کنید با جست‌وجو در اینترنت یا پرسش مستقیم از کارفرما، به این نتیجه برسیم که هر مأموریت فضایی به داده‌های زیر نیازمند است:</p>

<ul>
<li>کد مأموریت</li>
<li>عنوان مأموریت </li>
<li>سازمان مسئول</li>
<li>هدف از اجرا</li>
<li>شرح کوتاه مأموریت</li>
<li>تاریخ آغاز</li>
<li>تاریخ پایان</li>
<li>وضعیت تصویب</li>
<li>وضعیت اجرایی</li>
<li>نام و سمت فضانوردان شرکت‌کننده</li>
<li>نام و سمت کارکنان مرکز کنترل</li>
<li>اسناد و مدارک و عکس‌های یادگاری</li>
</ul>

<h2>حالا چه ستون‌هایی لازم داریم؟</h2>

<p>بله. حالا که می‌دانیم چه داده‌هایی را قرار است برای یک مأموریت نگهداری کنیم، می‌توانیم به ستون‌ها فکر کنیم و به این نیازمندی‌ها برسیم:</p>

<ul>
<li>یک ستون افزایش خودکار، به عنوان ایندکس اولیه که گفتیم همیشه نامش را <code>id</code> می‌گذاریم و همیشه در ابتدای هر جدول قرار می‌دهیم؛</li>
<li>ستون‌هایی از نوع متن، برای نگهداری کد و عنوان مأموریت و سازمان مسئول و هدف و شرح کوتاه؛</li>
<li>ستون‌هایی از نوع تاریخ برای نگهداری زمان آغاز و پایان رسمی مأموریت؛</li>
<li>ستونی از نوع منطقی برای این که بدانیم مأموریت مورد نظر ما به تصویب مقامات رسیده است یا خیر؛</li>
<li>ستونی برای نگهداری وضعیت اجرایی</li>
</ul>

<h3>وضعیت اجرایی</h3>

<p>این ستون وضعیت اجرایی کمی دردسرساز است. کارفرما می‌گوید که وضعیت اجرایی یکی از حالت‌های <code>«در حال برنامه‌ریزی»</code>، <code>«در حال اجرا»</code>، <code>«موفقیت‌آمیز»</code> و <code>«شکست‌خورده»</code> است و چیزی جز این چهار حالت وجود ندارد. پس ما می‌توانیم یک ستون متنی برای وضعیت در نظر بگیریم و یکی از همین چهار حالت را در آن ذخیره کنیم یا به هر کدام از حالت‌ها عددی را اختصاص دهیم و آن عدد قراردادی را در یک ستون از نوع عددی ذخیره کنیم.</p>

<p>اما راه بهتری هم وجود دارد: </p>

<p>به ازای هر کدام از این چهار وضعیت، یک ستون مستقل از نوع زمان در نظر می‌گیریم و تاریخ و ساعت وقوع هر یک از این وضعیت‌ها را در آن ثبت می‌کنیم:</p>

<ul>
<li>زمان شروع برنامه‌ریزی</li>
<li>زمان شروع اجرا</li>
<li>زمان پایان موفقیت‌آمیز</li>
<li>زمان شکست</li>
</ul>

<p>به این ترتیب، از نحوه‌ی پر شدن این ستون‌ها می‌توانیم به وضعیت مأموریت پی ببریم و این کار را در لایه‌ی مدل برنامه‌ی خود انجام می‌دهیم. </p>

<p>طبیعتاً یک مأموریت نمی‌تواند هم موفقیت‌آمیز باشد و هم شکست‌خورده تلقی شود و یکی از دو ستون پر می‌شود و به دیگری نیازی نیست. فعلاً نگران این موضوع نباشید و به این فکر کنید که تفکیک وضعیت اجرایی به چهار ستون زمانی، ما را دست از ستون‌های مبهم آغاز و پایان نیز خلاص می‌کند.</p>

<h3>ضمیمه‌های جدول</h3>

<p>نگهداری نام اشخاص دخیل در مأموریت، و همچنین گزارش‌ها و عکس‌های یادگاری در ستون‌های جدول مأموریت‌ها فکر خوبی نیست. بهتر است اطلاعات آن‌ها را در جداولی جداگانه نگهداری کنیم و سپس به این جدول متصل نماییم.</p>

<h2>متد بالارونده</h2>

<p>حالا می‌توانیم دست به کیبورد شویم و کد آنچه را که لازم داریم، بنویسیم. در متد بالارونده، موسوم به <code>up</code>، ترتیب برپا کردن جدول را می‌دهیم.</p>

<p>کد متد <code>up</code> شما باید چیزی به شکل زیر شود، هرچند می‌دانید که همه‌ی این کد را لازم نیست خودتان بنویسید. کنسول آرتیزان بخش‌هایی را از قبل برای شما نوشته بود.</p>

<pre><code class="language-php">public function up()
{
    Schema::create('missions', function (Blueprint $table) {
        $table-&gt;increments('id');
        $table-&gt;string('code')-&gt;index();
        $table-&gt;string('title')-&gt;index();
        $table-&gt;string('operator')-&gt;index();
        $table-&gt;mediumText('purpose')-&gt;nullable();
        $table-&gt;text('description')-&gt;nullable();
        $table-&gt;boolean('is_ratified')-&gt;default(false);
        $table-&gt;timestamp('planned_at')-&gt;nullable()-&gt;index();
        $table-&gt;timestamp('started_at')-&gt;nullable()-&gt;index();
        $table-&gt;timestamp('succeeded_at')-&gt;nullable()-&gt;index();
        $table-&gt;timestamp('failed_at')-&gt;nullable()-&gt;index();
        $table-&gt;timestamps();
        $table-&gt;softDeletes();
    });
}
</code></pre>

<p>پیش از آن که به خواندن ادامه دهید، کمی تأمل کنید و سعی کنید تک‌تک خط‌های قطعه کد بالا را برای خود تفسیر کنید که هر کدام چه می‌کنند.</p>

<p>ما در این کد، علاوه بر آنچه که بالاتر برنامه‌ریزی کردیم، جزئیات دیگری را هم رعایت کردیم.</p>

<ul>
<li>تمام ستون‌هایی که به نظر می‌رسید ممکن است به مرتب‌سازی و جست‌وجو نیاز داشته باشند را با استفاده از متد زنجیره‌ای <code>()index</code>، مشخص کردیم.</li>
<li>تمام ستون‌هایی که به نظر می‌رسید ممکن است اختیاری باشند را با استفاده از متد زنجیره‌ای <code>()nullable</code>، متمایز ساختیم تا غیبت اطلاعات، ما را با مشکلی مواجه نکند.</li>
<li>ستون منطقی وضعیت تصویب را به کمک متد زنجیره‌ای <code>()default</code> با یک مقدار پیش‌فرض پر کردیم.</li>
<li>به کمک متد <code>()timestamps</code> (خط ۱۶) دو ستون برای نگهداری زمان ایجاد و آخرین به‌روزرسانی هر رکورد اضافه کردیم تا لاراول، خودش، ترتیب بقیه‌ی کارها را بدهد.</li>
<li>به کمک متد <code>()softDeletes</code> (خط ۱۷) ستونی به نام <code>deleted_at</code> برای ایجاد قابلیت زباله‌دان ایجاد کردیم.</li>
</ul>

<p>اجرای این مایگرشن در دیتابیس mySql، باید جدولی به این شکل برای شما ایجاد کند.</p>

<p><img src="/laravel-0-to-60/images/migration-missions-structure.jpg" alt="Missions Table Structure" id="missionstablestructure" /></p>

<h2>متد پایین‌رونده</h2>

<p>یادتان هست که در متد پایین‌رونده باید چه می‌کردیم؟ </p>

<p>هر آنچه در متد <code>up</code> ساخته شده، می‌بایست در متد ‍<code>down</code> از بین برود تا عملکرد عقبگرد در مایگرشن به‌خوبی انجام شود.</p>

<p>متد بالارونده‌ی جدول مأموریت‌های ما، جدول را برپا ساخته بود و متد پایین‌رونده باید آن را نابود کند.</p>

<pre><code class="language-php">public function down()
{
    Schema::dropIfExists('missions');
}
</code></pre>

<p>اگر با من جلو آمده باشید، متوجه شده‌اید که این خط‌ها از قبل توسط آرتیزان نوشته شده بودند!</p>

<h1>جدولی برای اطلاعات آدم‌ها</h1>

<p>از آنجا که تقریباً تمام پروژه‌های وب که در عالم امکان وجود دارند، جدولی برای نگهداری اطلاعات کاربران نیاز دارند، لاراول مایگرشن ساده‌ای برای جدول <code>users</code> را در جعبه‌ی خود گذاشته که در بدو نصب، قابل استفاده است. </p>

<p>متد <code>up</code> این مایگرشن از پیش آماده شده، به شکل زیر است:</p>

<pre><code class="language-php">public function up()
{
    Schema::create('users', function (Blueprint $table) {
        $table-&gt;increments('id');
        $table-&gt;string('name');
        $table-&gt;string('email')-&gt;unique();
        $table-&gt;string('password');
        $table-&gt;rememberToken();
        $table-&gt;timestamps();
    });
}
</code></pre>

<p>به دستور ساخت ستون <code>id</code> در ابتدای کد، و متد <code>()timestamps</code> در انتهای آن توجه کنید و به خاطر بسپارید که در مایگرشن‌هایی که خودتان هم می‌نویسید این الگو را رعایت کنید تا ساختار دیتابیسی یکپارچه و استاندارد داشته باشید.</p>

<p>ستونی که با متد <code>()rememberToken‍</code> ساخته می‌شود، رشته‌ای صد کاراکتری در خود جای می‌دهد که به درد گزینه‌ی «مرا به خاطر بسپار» زیر فرم‌های لاگین می‌خورد و لاراول، خودش ترتیب استفاده از آن را می‌دهد. </p>

<h2>ستون‌های مورد نیاز ما</h2>

<p>ما برای آپولو هوا کردنمان، به تعدادی ستون دیگر هم نیاز داریم و هیچ اشکالی ندارد که آن‌ها را لابه‌لای همین ستون‌های پیش‌فرض، و در همین فایل مایگرشنی که از قبل مهیا شده بود، قرار دهیم. اما حالا که می‌خواهیم چیزی یاد بگیریم، بد نیست یک مایگرشن ویرایشگر بسازیم و ستون‌های خودمان را در مایگرشن خودمان به جدول کاربران اضافه کنیم.</p>

<h1>جان کلام</h1>

<p>جدول‌ها همیشه با اسامی جمع</p>

<p>تمام زمان‌ها nullable</p>

    </div>
  


</div>

<div class="section">
    <nav class="pagination" role="navigation" aria-label="pagination">
    <a href="/laravel-0-to-60/chapter03/lesson04/migrations/" class="pagination-previous button is-primary is-outlined">
    →
    طراحی دیتابیس با مایگرشن
  </a>
    </nav>
</div>
    </div>

  </section>

  <footer class="columns hero section is-dark has-text-centered">
        <div class="container ">
            <div class="columns">

                <div class="column">
                    <div class="footer-header">
                       به این جاها سر بزنید
                    </div>
                    <ul class="related-links has-text-centered">
                        <li>
                            <a href="/laravel-0-to-60/chapter00/lesson03/support/">حمایت از کتاب</a>
                        </li>
                        <li>
                            <a href="/laravel-0-to-60/chapter00/lesson05/publish/">مجوز انتشار</a>
                        </li>
                        <li>
                            <a href="https://github.com/dutymess/laravel-0-to-60/issues" target="_blank">گزارش مشکلات</a>
                        </li>
                        <li>
                          <a href="https://virgool.io/@taha" target="_blank">وبلاگ من در ویرگول</a>
                        </li>
                        <li>
                          <a href="https://blog.dutymess.ir" target="_blank">آن یکی وبلاگ من</a>
                        </li>
                        <li>
                          <a href="https://twitter.com/dutymessIr" target="_blank">و سرانجام، در توییتر</a>
                        </li>
                    </ul>
                </div>
                <div class="column">
                    <div class="footer-header">
                    لاراول از صفر تا شصت
                    </div>
                    <div class="socials">
                      <a href="/laravel-0-to-60">
                        <img class="cover" src="/laravel-0-to-60/images/cover-small.jpg">
                      </a>
                    </div>
                </div>

                <div class="column">
                    <div class="footer-header">
                      از درس‌های جدید آگاه شوید
                    </div>

                    <form action="https://github.us17.list-manage.com/subscribe/post?u=8118b4a1f2130d821eb534012&amp;id=a8b16a6c37" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate is-inline-block" target="_blank" novalidate>

                        <div class="field has-addons">
                            <div class="control">
                                <input name="EMAIL" class="input" type="email" placeholder="عضویت در خبرنامه">
                            </div>
                            <div class="control">
                                <button type="submit" class="button is-info">
                                    عضویت
                                </button>
                            </div>
                        </div>

                        <div id="mce-responses" class="clear">
                          <div class="response" id="mce-error-response" style="display:none"></div>
                          <div class="response" id="mce-success-response" style="display:none"></div>
                        </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->

                    </form>

                    <div class="text">
                      برای ارسال خبرنامه از سرویس
                      mailChimp
                      بهره می‌برم و فقط خبرهای مرتبط با همین کتاب را اطلاع‌رسانی می‌کنم.
                      از نشانی‌ها حتی برای پروژه‌های بعدی و مشابه خودم هم استفاده نمی‌کنم
                      چه برسد به آن که تبلیغ و هرزنامه بفرستم یا
                      خدای ناکرده در اختیار کس دیگری قرار دهم.
                    </div>


                </div>
            </div>
            <div class="has-text-centered credit">
              <div>
              کتاب
              <a href="https://github.com/dutymess/laravel-0-to-60" target="_blank">
              «لاراول، از صفر تا شصت»
              </a>
              با مجوز
              <a href="/laravel-0-to-60/chapter00/lesson05/publish/" >
                کرییتیو کامنز
              </a>
              به صورت رایگان و آزاد منتشر می‌شود و حقوق آن، در چارچوب مجوز یادشده، متعلق به نویسنده
              <a href="https://virgool.io/@taha" target="_blank">
                (طه کامکار)
              </a>
              است.

              </div>
              <div>
                ارائه شده بر بستر
                <a href="https://miraxy.github.io/doc-fa/" target="_blank">میرا</a>
              </div>
            </div>
        </div>
    </footer>


<script type="text/javascript" src="/laravel-0-to-60/static/js/jquery.min.js"></script>
<script src="/laravel-0-to-60/static/js/highlight.pack.js"></script>
<script src="/laravel-0-to-60/static/js/highlightjs-line-numbers.min.js"></script>
<script src="/laravel-0-to-60/static/js/app.js"></script>


</body>
</html>